<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>GRUPPO PROCIDA</title>
<link rel="manifest" href="manifest.json">
<link rel="stylesheet" href="styles.css">
<meta name="theme-color" content="#1c44ff">
<script>
if ('serviceWorker' in navigator) { window.addEventListener('load', ()=> navigator.serviceWorker.register('./sw.js')); }
</script>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="icon">ðŸ‘¥</div>
      <div class="title">GRUPPO PROCIDA</div>
      <div class="badge">Installabile</div>
    </div>

    <div class="card">
      <div class="toolbar">
        <div class="counters">
          <div class="counter ok" id="presenti">Presenti: 0</div>
          <div class="counter no" id="assenti">Assenti: 0</div>
        </div>
        <button class="reset" id="resetBtn">Reset</button>
      </div>
      <div class="list" id="list"></div>
    </div>

    <div class="footer">Stato salvato sul dispositivo. â€¢ Tap per marcare, WhatsApp per messaggio rapido, Reset per azzerare.</div>
  </div>

<script>
const ENTRIES = [{"full": "Celano Gerardina", "first": "Gerardina", "phone": "+393393156011"}, {"full": "Celano Gerardo", "first": "Gerardo", "phone": "+393405436406"}, {"full": "Celano Maria", "first": "Maria", "phone": "+393891014974"}, {"full": "D'aiutolo Maria", "first": "Maria", "phone": "+393406422813"}, {"full": "De Maio Gerardo", "first": "Gerardo", "phone": "+3934644267"}, {"full": "De Maio Nicoletta", "first": "Nicoletta", "phone": "+393484414230"}, {"full": "Della Sala Alessio", "first": "Alessio", "phone": "+393496569444"}, {"full": "Giannatiempo Concetta", "first": "Concetta", "phone": "+393400885966"}, {"full": "Giannatiempo Pasquale", "first": "Pasquale", "phone": "+393397230229"}, {"full": "Granozio Anacleto", "first": "Anacleto", "phone": "+393889784305"}, {"full": "Granozio Giuseppina", "first": "Giuseppina", "phone": "+393429375519"}, {"full": "Ignarro Cristina", "first": "Cristina", "phone": "+393392661784"}, {"full": "Pellegrino Benito", "first": "Benito", "phone": "+393808671683"}, {"full": "Pellegrino Noemi", "first": "Noemi", "phone": "+393275428780"}, {"full": "Procida Franca", "first": "Franca", "phone": "+393286558183"}, {"full": "Procida Paolo", "first": "Paolo", "phone": "+393388150535"}, {"full": "Salviati Angela", "first": "Angela", "phone": "+393382510257"}, {"full": "Salviati Mario", "first": "Mario", "phone": "+393393898171"}];
const KEY = 'procida_presence_v2';

function loadState() { try { return JSON.parse(localStorage.getItem(KEY)) || {}; } catch(e) { return {}; } }
function saveState(s) { localStorage.setItem(KEY, JSON.stringify(s)); }
function computeCounts(state) {
  let pres = 0;
  for (const e of ENTRIES) if (state[e.full]) pres++;
  return { pres, ass: ENTRIES.length - pres };
}
function waUrl(entry) {
  if (!entry.phone) return null;
  const msg = `Ciao ${entry.first}, questa sera non ti ho visto in sala, come stai? un abbraccio`;
  const encoded = encodeURIComponent(msg);
  const phone = (entry.phone || '').replace(/[^\d+]/g,'');
  return `https://wa.me/${phone}?text=${encoded}`;
}

function render() {
  const state = loadState();
  const list = document.getElementById('list');
  list.innerHTML = '';
  ENTRIES.forEach(entry => {
    const wrap = document.createElement('div');
    wrap.className = 'item';

    const name = document.createElement('div');
    name.className = 'name' + (state[entry.full] ? ' strike' : '');
    name.textContent = entry.full;
    name.addEventListener('click', ()=> { state[entry.full] = !state[entry.full]; saveState(state); render(); });

    const wa = document.createElement('button');
    wa.className = 'btn';
    if (entry.phone) {
      wa.textContent = 'WhatsApp';
      wa.addEventListener('click', (ev)=> {
        ev.stopPropagation();
        const url = waUrl(entry);
        if (url) window.open(url, '_blank');
      });
    } else {
      wa.textContent = 'No WA';
      wa.disabled = true;
      wa.style.opacity = .5;
    }

    const toggle = document.createElement('div');
    toggle.className = 'toggle' + (state[entry.full] ? ' checked' : '');
    toggle.addEventListener('click', (ev)=> { ev.stopPropagation(); state[entry.full] = !state[entry.full]; saveState(state); render(); });

    wrap.appendChild(name);
    wrap.appendChild(wa);
    wrap.appendChild(toggle);
    list.appendChild(wrap);
  });
  const c = computeCounts(state);
  document.getElementById('presenti').textContent = 'Presenti: ' + c.pres;
  document.getElementById('assenti').textContent = 'Assenti: ' + c.ass;
}

document.getElementById('resetBtn').addEventListener('click', ()=> { saveState({}); render(); });
render();
</script>
</body>
</html>